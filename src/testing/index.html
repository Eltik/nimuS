
<!DOCTYPE HTML>
<html>
    <head>
        <title>My First HTML Page</title>
        <script src="./cryptojs"></script>
    </head>
    <body>
        <script>
            var Base64 = {
                _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
                encode: function(e) {
                    var t = "";
                    var n, r, i, s, o, u, a;
                    var f = 0;
                    e = Base64._utf8_encode(e);
                    while (f < e.length) {
                        n = e.charCodeAt(f++);
                        r = e.charCodeAt(f++);
                        i = e.charCodeAt(f++);
                        s = n >> 2;
                        o = (n & 3) << 4 | r >> 4;
                        u = (r & 15) << 2 | i >> 6;
                        a = i & 63;
                        if (isNaN(r)) {
                            u = a = 64
                        } else if (isNaN(i)) {
                            a = 64
                        }
                        t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a)
                    }
                    return t
                },
                decode: function(e) {
                    var t = "";
                    var n, r, i;
                    var s, o, u, a;
                    var f = 0;
                    e = e.replace(/[^A-Za-z0-9\+\/\=]/g, "");
                    while (f < e.length) {
                        s = this._keyStr.indexOf(e.charAt(f++));
                        o = this._keyStr.indexOf(e.charAt(f++));
                        u = this._keyStr.indexOf(e.charAt(f++));
                        a = this._keyStr.indexOf(e.charAt(f++));
                        n = s << 2 | o >> 4;
                        r = (o & 15) << 4 | u >> 2;
                        i = (u & 3) << 6 | a;
                        t = t + String.fromCharCode(n);
                        if (u != 64) {
                            t = t + String.fromCharCode(r)
                        }
                        if (a != 64) {
                            t = t + String.fromCharCode(i)
                        }
                    }
                    t = Base64._utf8_decode(t);
                    return t
                },
                _utf8_encode: function(e) {
                    e = e.replace(/\r\n/g, "\n");
                    var t = "";
                    for (var n = 0; n < e.length; n++) {
                        var r = e.charCodeAt(n);
                        if (r < 128) {
                            t += String.fromCharCode(r)
                        } else if (r > 127 && r < 2048) {
                            t += String.fromCharCode(r >> 6 | 192);
                            t += String.fromCharCode(r & 63 | 128)
                        } else {
                            t += String.fromCharCode(r >> 12 | 224);
                            t += String.fromCharCode(r >> 6 & 63 | 128);
                            t += String.fromCharCode(r & 63 | 128)
                        }
                    }
                    return t
                },
                _utf8_decode: function(e) {
                    var t = "";
                    var n = 0;
                    var r = c1 = c2 = 0;
                    while (n < e.length) {
                        r = e.charCodeAt(n);
                        if (r < 128) {
                            t += String.fromCharCode(r);
                            n++
                        } else if (r > 191 && r < 224) {
                            c2 = e.charCodeAt(n + 1);
                            t += String.fromCharCode((r & 31) << 6 | c2 & 63);
                            n += 2
                        } else {
                            c2 = e.charCodeAt(n + 1);
                            c3 = e.charCodeAt(n + 2);
                            t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
                            n += 3
                        }
                    }
                    return t
                }
            }

            let encryptionKey = "password";

            function encrypt(url) {
                if (!encryptionKey) {
                    return null;
                }
                if (!url) {
                    url = "";
                }
                const encodedString = Base64.encode(url);
                const encrypted = CryptoJS.AES.encrypt(encodedString, encryptionKey).toString();
                const b64 = CryptoJS.enc.Base64.parse(encrypted);
                return b64.toString(CryptoJS.enc.Hex);
            }

            function decrypt(url) {
                if (!encryptionKey) {
                    return null;
                }
                const encrypted = CryptoJS.enc.Hex.parse(url);
                const b64 = encrypted.toString(CryptoJS.enc.Base64);
                const decrypted = CryptoJS.AES.decrypt(b64, encryptionKey);
                const decodedString = Base64.decode(decrypted.toString(CryptoJS.enc.Utf8));
                return decodedString;
            }

            function createHLS() {
                const hlsScript = document.createElement("script");
                hlsScript.src = "https://cdn.jsdelivr.net/npm/hls.js@latest/dist/hls.min.js"
                document.getElementsByTagName("body")[0].append(hlsScript);

                setTimeout(() => {
                    setTimeout(() => {
                        const div = document.createElement("div");
                        div.id = "video_wrap";
                        document.getElementsByTagName("body")[0].append(div);
                        
                        const video = document.createElement("video");
                        video.controls = true;
                        document.getElementById("video_wrap").append(video);

                        if (Hls.isSupported()) {
                            hls = new Hls();
                            hls.loadSource(sources[sources.length - 1].url);
                            hls.attachMedia(video);

                            hls.on(Hls.Events.MANIFEST_PARSED,function() {
                                let promise = document.querySelector('video').play();
                                if (promise !== undefined) {
                                    promise.then(_ => {
                                        // Playing
                                    }).catch(error => {
                                        // Can't play
                                    });
                                }
                            });
                        } else {
                            video.src = sources[sources.length - 1].url;
                        }
                    }, 1000);
                }, 200);
            }

            function createVideo() {
                const div = document.createElement("div");
                div.id = "video_wrap";
                document.getElementsByTagName("body")[0].append(div);
                
                const video = document.createElement("video");
                video.controls = true;
                document.getElementById("video_wrap").append(video);

                video.src = sources[sources.length - 1].url;

                document.body.append(div);
            }
        </script>
        </script>
        <button type="button" onclick="createHLS()">Create HLS</button>
        <button type="button" onclick="createVideo()">Create Video</button>
        <script>
            const sources = [
                {
                    "url": `/stream?magnet=${encrypt("magnet:?xt=urn:btih:ad9918214a5cfd8464f031e2c3c86675a700a8c8&dn=Gosick%20%20%5BDual%20Audio%5D%20%5BHEVC%5D%20%5B10-bit%5D%20%5BBDRip%5D%20%5BHD%201080p%5D%20%5Bbluury%5D&tr=http%3A%2F%2Fnyaa.tracker.wf%3A7777%2Fannounce&tr=udp%3A%2F%2Fopen.stealth.si%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337%2Fannounce&tr=udp%3A%2F%2Fexodus.desync.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.torrent.eu.org%3A451%2Fannounce")}/&file=${encrypt("Gosick 01 The Dark Reaper Finds the Golden Fairy.mkv")}`,
                    "quality": "1080p",
                    "isM3U8": true
                }
            ];

            const opStart = 0;
            const opEnd = 0;
        </script>
    </body>
</html>